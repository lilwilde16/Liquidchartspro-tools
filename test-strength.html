<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strength Engine Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .str-up { color: green; font-weight: bold; }
        .str-down { color: red; font-weight: bold; }
        table { border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        #log { background: #f5f5f5; padding: 10px; margin-top: 20px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Currency Strength Engine Test</h1>
    
    <div>
        <h2>Settings</h2>
        <label for="pairs">Trading Pairs (one per line):</label><br>
        <textarea id="pairs" rows="10" cols="50">EUR/USD
GBP/USD
USD/JPY
AUD/USD</textarea>
    </div>
    
    <div>
        <h2>Controls</h2>
        <label for="strengthTf">Timeframe:</label>
        <select id="strengthTf">
            <option value="300">M5 (300s)</option>
            <option value="900" selected>M15 (900s)</option>
            <option value="3600">H1 (3600s)</option>
        </select>
        
        <label for="strengthCount">Count:</label>
        <input type="number" id="strengthCount" value="300">
        
        <label for="strengthAutoSec">Auto (sec):</label>
        <input type="number" id="strengthAutoSec" value="60">
    </div>
    
    <div style="margin-top: 10px;">
        <button id="btnStrengthRun">Run Test</button>
        <button id="btnStrengthAuto">Start Auto</button>
        <button id="btnStrengthStop">Stop Auto</button>
    </div>
    
    <div id="strengthStatus" style="margin-top: 10px; font-style: italic;"></div>
    <div id="strengthTable"></div>
    <div id="strengthBestPairs"></div>
    
    <h2>Log</h2>
    <div id="log"></div>
    
    <script>
        // Mock LC framework for testing
        window.LC = {
            log: function(msg) {
                const logEl = document.getElementById('log');
                logEl.textContent = new Date().toLocaleTimeString() + ': ' + msg + '\n' + logEl.textContent;
                console.log(msg);
            },
            setStatus: function(text, kind) {
                console.log('Status:', text, kind);
            },
            requestCandles: async function(pair, timeframe, count) {
                // Mock candle data
                window.LC.log(`Mock: Requesting ${count} candles for ${pair} @ ${timeframe}s`);
                
                const candles = [];
                const basePrice = 1.1 + Math.random() * 0.1;
                for(let i = 0; i < count; i++) {
                    const price = basePrice + (Math.random() - 0.5) * 0.02 + (i / count) * 0.01;
                    candles.push({
                        close: price,
                        high: price * 1.001,
                        low: price * 0.999,
                        open: price
                    });
                }
                
                return { candles };
            }
        };
        
        // Mock UTIL for indicators
        window.UTIL = {
            sma: function(values, len) {
                const n = values.length;
                const out = new Array(n).fill(null);
                let sum = 0;
                for(let i = 0; i < n; i++) {
                    sum += values[i];
                    if(i >= len) sum -= values[i - len];
                    if(i >= len - 1) out[i] = sum / len;
                }
                return out;
            },
            atr: function(high, low, close, len) {
                const n = close.length;
                const tr = new Array(n).fill(null);
                for(let i = 1; i < n; i++) {
                    const a = high[i] - low[i];
                    const b = Math.abs(high[i] - close[i - 1]);
                    const c = Math.abs(low[i] - close[i - 1]);
                    tr[i] = Math.max(a, b, c);
                }
                const out = new Array(n).fill(null);
                let sum = 0;
                for(let i = 1; i <= len; i++) sum += (tr[i] ?? 0);
                let prev = sum / len;
                out[len] = prev;
                for(let i = len + 1; i < n; i++) {
                    prev = ((prev * (len - 1)) + (tr[i] ?? 0)) / len;
                    out[i] = prev;
                }
                return out;
            }
        };
    </script>
    
    <script src="js/engine-strength.js"></script>
    
    <script>
        // Initialize the engine
        if(window.ENG?.Strength?.init) {
            window.ENG.Strength.init();
            window.LC.log('Strength engine initialized');
        }
    </script>
</body>
</html>
