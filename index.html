<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>LiquidChartsPro Tools</title>

  <script src="https://pro.liquidcharts.com/scripts/widget-js"></script>
  <link rel="stylesheet" href="https://pro.liquidcharts.com/scripts/widget-css">
  <link rel="stylesheet" href="./css/app.css">
</head>

<body class="Widget">
  <div id="app">
    <div class="tabs">
      <button class="tabBtn active" data-tab="home">Home</button>
      <button class="tabBtn" data-tab="settings">Settings</button>
      <button class="tabBtn" data-tab="strength">Strength</button>
      <button class="tabBtn" data-tab="backtest">Backtest</button>
      <button class="tabBtn" data-tab="tools">Tools</button>
    </div>

    <section class="page" id="page-home">
      <div class="card home-gold">
        <h1 class="title">LiquidChartsPro Tools</h1>
        <div class="subtitle" id="homeProofText">A gold-standard control panel for framework checks, smart strength scanning, adaptive auto-trading, and sharp backtest planning.</div>
        <div class="row">
          <div class="field">
            <label>Status</label>
            <div class="pill" id="statusPill">Loading framework…</div>
          </div>
          <div class="field">
            <label>Instrument (chart)</label>
            <input id="ctxInstrument" value="Unknown" readonly />
          </div>
          <div class="field">
            <label>Timeframe (chart)</label>
            <input id="ctxTf" value="Unknown" readonly />
          </div>
        </div>
        <div class="btnRow">
          <button id="btnPing" class="primary" disabled>Ping Framework</button>
          <button id="btnReqPrices" disabled>RequestPrices (test)</button>
        </div>
      </div>

      <div class="card">
        <h2 class="title">Activity Log</h2>
        <div id="log" class="log"></div>
      </div>

    </section>

    <section class="page hidden" id="page-settings">
      <div class="card">
        <h2 class="title">Settings</h2>
        <div class="subtitle">Pairs universe (one per line).</div>
        <textarea id="pairs" class="mono" rows="6" placeholder="EUR/USD&#10;GBP/USD"></textarea>
        <div class="btnRow">
          <button id="saveSettings">Save</button>
          <div class="subtitle" id="settingsStatus"></div>
        </div>
      </div>
    </section>

    <section class="page hidden" id="page-strength">
      <div class="card">
        <h2 class="title">Currency Strength</h2>
        <div class="row">
          <div class="field">
            <label>Timeframe</label>
            <select id="strengthTf">
              <option value="300">M5</option>
              <option value="900" selected>M15</option>
              <option value="1800">M30</option>
            </select>
          </div>
          <div class="field">
            <label>Candles</label>
            <input id="strengthCount" type="number" value="500" min="100" max="5000" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Auto refresh (sec)</label>
            <input id="strengthAutoSec" type="number" value="60" min="10" max="900" step="5" />
          </div>
        </div>
        <div class="btnRow">
          <button id="btnStrengthRun" class="primary" disabled>Refresh Now</button>
          <button id="btnStrengthAuto" disabled>Start Auto Refresh</button>
          <button id="btnStrengthStop" disabled>Stop Auto</button>
        </div>
        <div class="subtitle" id="strengthStatus">No results yet.</div>
      </div>

      <div class="card">
        <h2 class="title">Best Pairs to Trade</h2>
        <div id="strengthBestPairs" class="subtitle">No results yet.</div>
      </div>

      <div class="card">
        <h2 class="title">Strength Table</h2>
        <div id="strengthTable"></div>
      </div>
    </section>

    <section class="page hidden" id="page-backtest">
      <div class="card">
        <h2 class="title">Backtest Planner</h2>
        <div class="row">
          <div class="field">
            <label>Instrument</label>
            <select id="btInstrument"></select>
          </div>
          <div class="field">
            <label>Timeframe</label>
            <select id="btTf">
              <option value="M5">M5</option>
              <option value="M15" selected>M15</option>
              <option value="M30">M30</option>
              <option value="H1">H1</option>
              <option value="H4">H4</option>
            </select>
          </div>
          <div class="field">
            <label>Strategy</label>
            <select id="btStrategyPreset"></select>
          </div>
          <div class="field">
            <label>Trade count</label>
            <input id="btCount" type="number" value="100" min="10" max="5000" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Fast MA length</label>
            <input id="btFastMa" type="number" value="10" min="2" max="100" step="1" />
          </div>
          <div class="field">
            <label>Slow MA length</label>
            <input id="btSlowMa" type="number" value="30" min="3" max="500" step="1" />
          </div>
          <div class="field">
            <label>ATR length</label>
            <input id="btAtrLen" type="number" value="14" min="5" max="100" step="1" />
          </div>
        </div>

        <label>Strategy rules</label>
        <textarea id="btStrategy" class="mono" rows="5" readonly>Entry: Fast SMA crosses above/below Slow SMA
Exit: Stop loss at ATR multiple and take profit at selected RR
Filter: Optional long-only via Allow short trades toggle</textarea>

        <div class="row">
          <div class="field">
            <label>Risk:Reward</label>
            <select id="btRr">
              <option value="1">1:1</option>
              <option value="1.5">1:1.5</option>
              <option value="2" selected>1:2</option>
              <option value="2.5">1:2.5</option>
              <option value="3">1:3</option>
            </select>
          </div>
          <div class="field">
            <label>Backtest source</label>
            <input value="Live LiquidCharts candles" readonly />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Starting balance ($)</label>
            <input id="btStartBalance" type="number" value="10000" min="100" step="100" />
          </div>
          <div class="field">
            <label>Risk per trade (%)</label>
            <input id="btRiskPct" type="number" value="1" min="0.1" max="10" step="0.1" />
          </div>
          <div class="field">
            <label>Trading cost (R / trade)</label>
            <input id="btCostR" type="number" value="0.05" min="0" max="2" step="0.01" />
          </div>
          <div class="field">
            <label>Stop size (ATR multiple)</label>
            <input id="btSlAtr" type="number" value="1" min="0.2" max="5" step="0.1" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Candles to fetch</label>
            <input id="btCandleCount" type="number" value="2500" min="300" max="20000" step="100" />
          </div>
          <div class="field">
            <label>Allow short trades</label>
            <select id="btAllowShort">
              <option value="yes" selected>Yes</option>
              <option value="no">No (long only)</option>
            </select>
          </div>
          <div class="field">
            <label>Session filter</label>
            <select id="btSession">
              <option value="all" selected>All market hours</option>
              <option value="london">London</option>
              <option value="newyork">New York</option>
              <option value="custom">Custom hours</option>
            </select>
          </div>
          <div class="field">
            <label>Intrabar conflict model</label>
            <select id="btConflictModel">
              <option value="conservative" selected>Conservative (SL first)</option>
              <option value="optimistic">Optimistic (TP first)</option>
              <option value="skip">Skip ambiguous trades</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Start date (UTC)</label>
            <input id="btStartDate" type="date" />
          </div>
          <div class="field">
            <label>End date (UTC)</label>
            <input id="btEndDate" type="date" />
          </div>
          <div class="field">
            <label>Start hour (UTC)</label>
            <input id="btStartHour" type="number" value="0" min="0" max="23" step="1" />
          </div>
          <div class="field">
            <label>End hour (UTC)</label>
            <input id="btEndHour" type="number" value="23" min="0" max="23" step="1" />
          </div>
        </div>

        <div class="btnRow">
          <button id="btnRunBt" class="primary" disabled>Run Backtest</button>
          <button id="btnStopBt" disabled>Stop</button>
          <button id="btnClearBt">Clear</button>
        </div>
      </div>

      <div class="card">
        <h2 class="title">Summary</h2>
        <div id="btSummary" class="subtitle">No results yet.</div>
      </div>


      <div class="card modern-note">
        <h2 class="title">Weekly scalping playbook</h2>
        <div class="subtitle">
          1) Run <strong>Strength Scanner</strong> every 15-60 minutes.<br>
          2) Pick top mover vs weakest (avoid flat spreads).<br>
          3) In Backtest, choose <strong>Strength Scalper (Weekly Focus)</strong> on M15, London session.<br>
          4) Keep risk low (0.25%–0.75% per trade), stop after daily loss limit, and review weekly.
        </div>
      </div>

      <div class="card">
        <h2 class="title">Trades</h2>
        <div id="btTrades"></div>
      </div>
    </section>

    <section class="page hidden" id="page-tools">
      <div class="card">
        <h2 class="title">Tools</h2>

        <div class="row">
          <div class="field">
            <label>Market selector</label>
            <select id="toolPair"></select>
          </div>
          <div class="field">
            <label>Lots</label>
            <input id="toolQty" type="number" value="0.01" min="0.01" step="0.01" />
          </div>
          <div class="field">
            <label>TP distance (points)</label>
            <input id="toolTpPips" type="number" value="55" min="1" step="0.1" />
          </div>
          <div class="field">
            <label>SL distance (points)</label>
            <input id="toolSlPips" type="number" value="55" min="1" step="0.1" />
          </div>
          <div class="field">
            <label>OrderId (for CHANGE)</label>
            <input id="toolOrderId" type="text" placeholder="e.g. 1225824612" />
          </div>
          <div class="field">
            <label>ARM</label>
            <select id="toolArm">
              <option value="off" selected>OFF (Ticket only)</option>
              <option value="on">ON (SendOrder)</option>
            </select>
          </div>
        </div>

        <div class="btnRow">
          <button id="btnDiagRun" disabled>Run Data + Trading Diagnostics</button>
          <button id="btnPrices" disabled>Request Prices</button>
          <button id="btnTicket" disabled>Open Deal Ticket</button>
          <button id="btnBuyMarket" class="primary" disabled>BUY (market)</button>
          <button id="btnSellMarket" class="sell" disabled>SELL (market)</button>
          <button id="btnBuyTPSL" class="primary" disabled>BUY + TP/SL (ABS)</button>
          <button id="btnSellTPSL" class="sell" disabled>SELL + TP/SL (ABS)</button>
          <button id="btnChangeTPSL" disabled>CHANGE TP/SL</button>
          <button id="btnDumpTrades" disabled>Dump Open Trades</button>
          <button id="btnCloseAll" class="sell" disabled>Close All (instrument)</button>
        </div>

        <div class="row" style="margin-top:8px;">
          <div class="field">
            <label>Price feed</label>
            <div class="pill" id="toolPx">bid/ask: …</div>
          </div>
        </div>

        <div class="btnRow">
          <button id="btnHealth" disabled>Health Check</button>
          <button id="btnRefreshTool">Refresh Tool</button>
          <button id="btnClearLog" disabled>Clear Log</button>
        </div>
      </div>

      <div class="card">
        <h2 class="title">Auto Trader (Mon-Fri)</h2>
        <div class="subtitle">Uses strength ranking + supply/demand zone confirmation. No strategy is foolproof; keep ARM OFF until forward-tested.</div>
        <div class="row">
          <div class="field">
            <label>Signal timeframe</label>
            <select id="atTf">
              <option value="M5">M5</option>
              <option value="M15" selected>M15</option>
              <option value="M30">M30</option>
              <option value="H1">H1</option>
            </select>
          </div>
          <div class="field">
            <label>Candles per scan</label>
            <input id="atCandles" type="number" value="500" min="200" max="3000" step="50" />
          </div>
          <div class="field">
            <label>Scan interval (sec)</label>
            <input id="atPollSec" type="number" value="120" min="30" max="3600" step="10" />
          </div>
          <div class="field">
            <label>Lots</label>
            <input id="atLots" type="number" value="0.01" min="0.01" step="0.01" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Risk:Reward</label>
            <input id="atRr" type="number" value="1.5" min="1" max="4" step="0.1" />
          </div>
          <div class="field">
            <label>SL ATR multiple</label>
            <input id="atSlAtr" type="number" value="1.1" min="0.5" max="4" step="0.1" />
          </div>
          <div class="field">
            <label>Use Mon-Fri schedule</label>
            <select id="atUseSchedule">
              <option value="yes" selected>Yes</option>
              <option value="no">No</option>
            </select>
          </div>
          <div class="field">
            <label>Risk profile</label>
            <select id="atRiskMode">
              <option value="conservative" selected>Conservative</option>
              <option value="balanced">Balanced</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Start hour UTC</label>
            <input id="atStartHour" type="number" value="6" min="0" max="23" step="1" />
          </div>
          <div class="field">
            <label>End hour UTC</label>
            <input id="atEndHour" type="number" value="20" min="0" max="23" step="1" />
          </div>
          <div class="field">
            <label>Volatile window start UTC</label>
            <input id="atVolStart" type="number" value="12" min="0" max="23" step="1" />
          </div>
          <div class="field">
            <label>Volatile window end UTC</label>
            <input id="atVolEnd" type="number" value="16" min="0" max="23" step="1" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label>Max trades / day</label>
            <input id="atMaxTradesDay" type="number" value="4" min="1" max="20" step="1" />
          </div>
          <div class="field">
            <label>Cooldown (min)</label>
            <input id="atCooldownMin" type="number" value="45" min="1" max="240" step="1" />
          </div>
          <div class="field">
            <label>Adaptive learning</label>
            <select id="atLearning">
              <option value="on" selected>ON</option>
              <option value="off">OFF</option>
            </select>
          </div>
          <div class="field">
            <label>Minimum confidence</label>
            <input id="atMinConfidence" type="number" value="0.58" min="0.4" max="0.9" step="0.01" />
          </div>
        </div>
        <div class="btnRow">
          <button id="btnAutoStart" class="primary" disabled>Start Auto Trader</button>
          <button id="btnAutoStop" disabled>Stop Auto Trader</button>
        </div>
        <div class="subtitle" id="atStatus">Stopped.</div>
      </div>
    </section>

  </div>

  <script src="./js/ui-tabs.js"></script>
  <script src="./js/util-format.js"></script>
  <script src="./js/util-indicators.js"></script>
  <script src="./js/strategy-registry.js"></script>
  <script src="./js/lc-framework.js"></script>
  <script src="./js/engine-strength.js"></script>
  <script src="./js/engine-backtest.js"></script>
  <script src="./js/engine-autotrader.js"></script>
  <script src="./js/app.js"></script>
</body>
</html>